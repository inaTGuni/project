package dao;import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;import java.util.ArrayList;import java.util.List;import beans.Article;import beans.MyData;import beans.User;//DriverAccessorを継承public class Dao extends DriverAccessor{	//DBとのコネクションを入れる変数	private Connection connection;	public static final String UTF_8 = "UTF-8";	public static final String MS932 = "MS932";	public Dao(){	}	//ユーザidを入力すると，そのidを持つUserを返す	public User getUserById(String id) {		User user = new User();		this.connection = this.createConnection();		try{			String sql = "select * from user where id = ?";			PreparedStatement stmt = this.connection.prepareStatement(sql);			stmt.setString(1, id);			ResultSet rs = stmt.executeQuery();						if(rs.first()){				user.setId( rs.getString("id") );				user.setPassword( rs.getString("password") );				user.setName( rs.getString("name") );				user.setEntryDatetime( rs.getDate("entry_datetime") );			}			else{				this.closeConnection(this.connection);				return null;			}		}catch(SQLException e){			this.closeConnection(this.connection);			e.printStackTrace();			return null;		} finally {			this.closeConnection(this.connection);		}		return user;	}	//Userを受け取り，DBに格納する	public void insertUser(User user) {		this.connection= this.createConnection();		try{			String sql = "insert into user (id, password, name, entry_datetime) values(?, ?, ?, now())";			PreparedStatement stmt = this.connection.prepareStatement(sql);			stmt.setString(1, user.getId() );			stmt.setString(2, user.getPassword());			stmt.setString(3, user.getName());			stmt.executeUpdate();			stmt.close();			this.closeConnection(connection);		}catch(SQLException e){			this.closeConnection(connection);			e.printStackTrace();		} finally {			this.closeConnection(connection);		}	}	public Article getArticleById(int id) {		Article article = new Article();		this.connection = this.createConnection();		try{			String sql = "select * from article where id = ?";			PreparedStatement stmt = this.connection.prepareStatement(sql);			stmt.setInt(1, id);			ResultSet rs = stmt.executeQuery();			if(rs.first()){				article.setId( rs.getInt("id") );				article.setTitle( rs.getString("title") );				article.setBody( rs.getString("body") );				article.setEditorId( rs.getString("editor_id") );				article.setEntryDatetime( rs.getTimestamp("entry_datetime") );			}			else{				this.closeConnection(this.connection);				return null;			}		}catch(SQLException e){			this.closeConnection(this.connection);			e.printStackTrace();			return null;		} finally {			this.closeConnection(this.connection);		}		return article;	}	public Article getNewestArticleByEditorId(String editorId) {		Article article = new Article();		this.connection = this.createConnection();		try{			String sql = "select * from article where editor_id = ? order by entry_datetime desc";			PreparedStatement stmt = this.connection.prepareStatement(sql);			stmt.setString(1, editorId);			ResultSet rs = stmt.executeQuery();			if(rs.first()){				article.setId( rs.getInt("id") );				article.setTitle( rs.getString("title") );				article.setBody( rs.getString("body") );				article.setEditorId( rs.getString("editor_id") );				article.setEntryDatetime( rs.getTimestamp("entry_datetime"));			}			else{				this.closeConnection(this.connection);				return null;			}		}catch(SQLException e){			this.closeConnection(this.connection);			e.printStackTrace();			return null;		} finally {			this.closeConnection(this.connection);		}		return article;	}	public void insertArticle(Article article) {		this.connection= this.createConnection();		try{			String sql = "insert into article (title, body, editor_id, entry_datetime) values(?, ?, ?, now())";			PreparedStatement stmt = this.connection.prepareStatement(sql);			stmt.setString(1, article.getTitle());			stmt.setString(2, article.getBody());			stmt.setString(3, article.getEditorId());			stmt.executeUpdate();			stmt.close();			this.closeConnection(connection);		}catch(SQLException e){			this.closeConnection(connection);			e.printStackTrace();		} finally {			this.closeConnection(connection);		}	}	//すべての記事のリストを返す	public List<Article> getArticleList() {		this.connection= this.createConnection();		List<Article> articleList = new ArrayList<Article>();		try{			String sql = "select * from article order by entry_datetime desc";			PreparedStatement stmt = this.connection.prepareStatement(sql);			ResultSet rs = stmt.executeQuery();			if(rs.first()){				do{					Article s = new Article( rs.getInt("id"), rs.getString("title"), rs.getString("body"), rs.getString("editor_id"), rs.getTimestamp("entry_datetime") );					articleList.add(s);				}while(rs.next());			}		}catch(SQLException e){			this.closeConnection(connection);			e.printStackTrace();		} finally {			this.closeConnection(connection);		}		return articleList;	}		public void updateUser(User user) {		this.connection= this.createConnection();		try{			String sql = "update user set password=?, name=? where id=?";			PreparedStatement stmt = this.connection.prepareStatement(sql);			stmt.setString(1, user.getPassword() );			stmt.setString(2, user.getName());			stmt.setString(3, user.getId());			stmt.executeUpdate();			stmt.close();			this.closeConnection(connection);		}catch(SQLException e){			this.closeConnection(connection);			e.printStackTrace();		} finally {			this.closeConnection(connection);		}	}		// --- 自作部分（ここを修正） ---		// 引数に name と textColor を追加	public void insertMyData(String data, String color, String name, String textColor) {		this.connection= this.createConnection();		try{			// name と text_color を追加して保存			String sql = "insert into mydata (data, color, name, text_color, entry_datetime) values(?, ?, ?, ?, now())";			PreparedStatement stmt = this.connection.prepareStatement(sql);			stmt.setString(1, data);			stmt.setString(2, color);			stmt.setString(3, name);			stmt.setString(4, textColor);			stmt.executeUpdate();			stmt.close();			this.closeConnection(connection);		}catch(SQLException e){			this.closeConnection(connection);			e.printStackTrace();		} finally {			this.closeConnection(connection);		}	}		//すべてのMyDataのリストを返す	public List<MyData> getMyDataList() {		this.connection= this.createConnection();				List<MyData> MyDataList = new ArrayList<>();		try{			String sql = "select * from mydata order by entry_datetime desc";			PreparedStatement stmt = this.connection.prepareStatement(sql);			ResultSet rs = stmt.executeQuery();			if(rs.first()){				do{					// 基本データを作成					MyData s = new MyData( rs.getInt("id"), rs.getString("data"), rs.getString("color"), rs.getTimestamp("entry_datetime") );										// 追加データ（名前と文字色）をセット					// DBカラムにnullが入っている可能性も考慮しつつセット					s.setName(rs.getString("name"));					s.setTextColor(rs.getString("text_color"));										MyDataList.add(s);				}while(rs.next()); 			}		}catch(SQLException e){			this.closeConnection(connection);			e.printStackTrace();		} finally {			this.closeConnection(connection);		}		return MyDataList;	}}